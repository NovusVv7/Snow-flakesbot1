import asyncio
import sqlite3
import aiogram
from aiogram import Bot, types
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton

bot_token = '7561318621:AAHLIMv1cQPXSkBYWkFCeys5XsXg2c4M3fc'
bot = Bot(token=bot_token)

async def send_broadcast():
    conn_users = sqlite3.connect('users.db')
    conn_chats = sqlite3.connect('chats.db')
    cursor_users = conn_users.cursor()
    cursor_chats = conn_chats.cursor()
    cursor_users.execute("SELECT id FROM users")
    cursor_chats.execute("SELECT chat_id FROM chats")
    users = cursor_users.fetchall()
    chats = cursor_chats.fetchall()
    conn_users.close()
    conn_chats.close()

    keyboard = InlineKeyboardMarkup()
    button_add_bot = InlineKeyboardButton(text='–î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ ü§ñ', url='https://t.me/mglgamebot?startgroup=MGL&admin=change_info+restrict_members+delete_messages+pin_messages+invite_users')
    keyboard.add(button_add_bot)

    message_text = "<b>üöÄ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç MGL Bot üì¢</b>\n"
    message_text += "<i>–í–Ω–∏–º–∞–Ω–∏–µ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º! –£ –Ω–∞—Å –µ—Å—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –±–æ–ª—å—à–∏—Ö –≥—Ä—É–ø–ø –∏ —á–∞—Ç–æ–≤!</i>\n"
    message_text += "<i>üéâ–ï—Å–ª–∏ –≤—ã –¥–æ–±–∞–≤–∏—Ç–µ –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞ MGL ü§ñ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç–µ –µ–º—É –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ –≤–∞—à–µ–º —á–∞—Ç–µ, –≥–¥–µ –±–æ–ª–µ–µ 1000 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ (–±–µ–∑ –Ω–∞–∫—Ä—É—Ç–∫–∏) üìä, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ VIP-—Å—Ç–∞—Ç—É—Å –≤ –±–æ—Ç–µ –Ω–∞ —Ü–µ–ª—ã–π –º–µ—Å—è—Ü!</i>\n"
    message_text += "<b>ü•á–≠—Ç–æ –≤–∞—à —à–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è VIP-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π üòÄ</b>\n"
    message_text += "–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ—é –Ω–∞–≥—Ä–∞–¥—É, –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ –≤ –õ–° @fixouck_qq üì© –ù–µ —É–ø—É—Å—Ç–∏—Ç–µ —ç—Ç—É –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å! ‚ù§"

    success_chats = 0
    success_users = 0

    for user in users:
        try:
            await bot.send_message(user[0], message_text, reply_markup=keyboard, parse_mode='HTML')
            success_users += 1
            await asyncio.sleep(0.15)
        except aiogram.exceptions.BotBlocked:
            print(f"Target [ID:{user[0]}]: blocked by user")
        except Exception as e:
            print(f"Target [ID:{user[0]}]: {e.__class__.__name__}")

    for chat in chats:
        try:
            await bot.send_message(chat[0], message_text, reply_markup=keyboard, parse_mode='HTML')
            success_chats += 1
            await asyncio.sleep(0.15)
        except aiogram.exceptions.BotBlocked:
            print(f"Target [ID:{chat[0]}]: blocked by user")
        except Exception as e:
            print(f"Target [ID:{chat[0]}]: {e.__class__.__name__}")

    print(f"–£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ {success_chats} —á–∞—Ç–æ–≤, –∏ –≤ {success_users} –õ–°! üòé")

async def main():
    print("–†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è")
    await send_broadcast()
    print("–†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞")

asyncio.run(main())